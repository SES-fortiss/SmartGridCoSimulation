# List the start up tasks. Learn more https://www.gitpod.io/docs/config-start-tasks/
#image:
#  file: .gitpod.Dockerfile
  
tasks:
  - init: echo 'maven build'
    command: |
      mvn -f projects/memapOpcServer/pom.xml clean compile install -Dmaven.test.skip=true 
      mvn -f core/cim15/pom.xml clean compile install -Dmaven.test.skip=true 
      mvn -f core/powerflow/pom.xml clean compile install -Dmaven.test.skip=true 
      mvn -f core/gridarchitect/pom.xml clean compile install -Dmaven.test.skip=true
      mvn -f projects/memapCore/pom.xml clean compile install -Dmaven.test.skip=true
      mvn -f projects/memapGui/pom.xml clean compile install -Dmaven.test.skip=true
      mkdir artifacts
      cp projects/memapGui/target/*jar-with-dependencies.jar artifacts/memapPlanungsTool.jar
      cp projects/memapCore/target/*jar-with-dependencies.jar artifacts/memapServer.jar
      echo ' > starting MEMAP simulation environment'
      java -jar artifacts/memapServer.jar jetty 5 15
      
  - init: echo 'Onboarding of Buildings'
    command: |
      gp await-port 8013
      gp await-port 4851
      gp await-port 4852
      java -cp artifacts/memapServer.jar memap.websocket.TwoBuildingExample
      
  - init: echo 'Starting two Mock-Up Bulding EMS-Server, using the MEMAP OPC UA data model'
    command: |
      python3 OPC-UA-MockupBuildings/CoSES/02_Interface_Server/House1/CoSES_Server_Haus1.py
      python3 OPC-UA-MockupBuildings/CoSES/02_Interface_Server/House2/CoSES_Server_Haus2.py


# List the ports to expose. Learn more https://www.gitpod.io/docs/config-ports/
ports:
  - port: 8013
    onOpen: notify
  - port: 7013
    onOpen: ignore
  - port: 3000
    onOpen: ignore
  - port: 4851
    onOpen: ignore
  - port: 4852
    onOpen: ignore
